const fs = require('fs');

class Contenedor {
    constructor(archivo) {
        this.archivo = archivo;
    }

    save = async (producto) => {
        try {

            if (fs.existsSync(this.archivo)) {

                let info = await fs.promises.readFile(this.archivo, 'utf8');
                let result = JSON.parse(info);
                if (result.length > 0) {
                    let lastId = result[result.length - 1].id+1
                    let newProduct = {
                        id: lastId,
                        ...producto
                    }
                } else {
                    let lastId = 1
                    let newProduct = {
                        id: lastId,
                        ...producto
                    }
                    result.push(newProduct);
                    await fs.promises.writeFile(this.archivo, JSON.stringify(result, null, 2))
                    return lastId;

                }
            } else {

                let newProduct = {
                    id: 1,
                    title: producto.title,
                    price: producto.price,
                    thumbnail: producto.thumbnail
                }
                await fs.promises.writeFile(this.archivo, JSON.stringify([newProduct], null, 2))
                return 1;
            }
        } catch (error) {
            console.log(error)
        }
        
    }
}


let contenedor = new Contenedor("productos.txt");

let producto1 = {
    title: "papitas",
    price: 200,
    thumbnail: "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.recetas360.com%2Fcomo-hacer-patatas-fritas%2F&psig=AOvVaw3zpeD2ylgbXWd6s7cNbYr7&ust=1666283491694000&source=images&cd=vfe&ved=0CA0QjRxqFwoTCMDEvu_b7PoCFQAAAAAdAAAAABAE"
}

let producto2 = {
    title: "Nike Air Force",
    price: 1100,
    thumbnail: "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.recetas360.com%2Fcomo-hacer-patatas-fritas%2F&psig=AOvVaw3zpeD2ylgbXWd6s7cNbYr7&ust=1666283491694000&source=images&cd=vfe&ved=0CA0QjRxqFwoTCMDEvu_b7PoCFQAAAAAdAAAAABAE"
}



metodos = async () => {
    console.log(await contenedor.save(producto1))
    console.log(await contenedor.save(producto2))
}

metodos()
