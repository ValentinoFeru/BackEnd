const fs = require('fs');

class Contenedor {
    constructor(archivo) {
        this.archivo = archivo;
    }

    save = async (producto) => {
        try {

            if (fs.existsSync(this.archivo)) {

                let info = await fs.promises.readFile(this.archivo, 'utf8');
                let result = JSON.parse(info);
                if (result.length > 0) {
                    let lastId = result[result.length - 1].id + 1
                    let newProduct = {
                        id: lastId,
                        ...producto
                    }
                    result.push(newProduct);
                    await fs.promises.writeFile(this.archivo, JSON.stringify(result, null, 2))
                    return lastId;


                } else {
                    let lastId = 1
                    let newProduct = {
                        id: lastId,
                        ...producto
                    }
                    result.push(newProduct);
                    await fs.promises.writeFile(this.archivo, JSON.stringify(result, null, 2))
                    return lastId;
                }


            } else {

                let newProduct = {
                    id: 1,
                    title: producto.title,
                    price: producto.price,
                    thumbnail: producto.thumbnail
                }
                await fs.promises.writeFile(this.archivo, JSON.stringify([newProduct], null, 2))
                return 1;
            }
        } catch (error) {
            console.log(error)
        }

    }
}


let contenedor = new Contenedor("productos.txt");

let producto1 = {
    title: "Nike Air Vapormax",
    price: 2200,
    thumbnail: "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.grid.com.ar%2Fzapatillas-nike-air-vapormax-moda-mujer-3160284%2Fp&psig=AOvVaw2z2kMBVnlXolvwiOHoegGk&ust=1666288498446000&source=images&cd=vfe&ved=0CA0QjRxqFwoTCKCJzcLu7PoCFQAAAAAdAAAAABAE"
}

let producto2 = {
    title: "Nike Air Force",
    price: 2000,
    thumbnail: "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.grid.com.ar%2Fzapatillas-nike-sportswear-air-force-1-moda-ninos-3069319%2Fp&psig=AOvVaw3oqz4oe_FIgpSTmv-6ei-x&ust=1666288474510000&source=images&cd=vfe&ved=0CA0QjRxqFwoTCJCooLfu7PoCFQAAAAAdAAAAABAE"
}

let producto3 = {
    title: "Nike Air Force",
    price: 2000,
    thumbnail: "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.grid.com.ar%2Fzapatillas-nike-sportswear-air-force-1-moda-ninos-3069319%2Fp&psig=AOvVaw3oqz4oe_FIgpSTmv-6ei-x&ust=1666288474510000&source=images&cd=vfe&ved=0CA0QjRxqFwoTCJCooLfu7PoCFQAAAAAdAAAAABAE"
}



metodos = async () => {
    console.log(await contenedor.save(producto1))
    console.log(await contenedor.save(producto2))
    console.log(await contenedor.save(producto3))
}

metodos()
